---
import SectionRendererAnimalList from '@shared/components/sections/SectionRendererAnimalList.astro';
import SectionRendererHero from '@shared/components/sections/SectionRendererHero.astro';
import SectionRendererTitle from '@shared/components/sections/SectionRendererTitle.astro';
import type { CmsArticle, SectionType } from 'sheltify-lib/article-types.ts';
import SectionRendererText from './sections/SectionRendererText.astro';

interface Props {
  article: CmsArticle;
}

const { article } = Astro.props;
const fullWidthSections: SectionType[] = ['hero'];

let rowindex = 0;

const topPadding = 48;
---
<div style={'margin-top: ' + topPadding + 'px'} class="themable article sui flex-y">

{
  article.Structure.Rows.map(row =>
    {
      // if a hero is the first row, we need negate of the initial top padding so it's placed right below the header
      const isTopHero = rowindex == 0 && row.Sections.length == 1 && row.Sections[0].SectionType == 'hero';
      rowindex++;
      const isFullWidth = row.Sections.length == 1 && fullWidthSections.includes(row.Sections[0].SectionType);
      const sections = row.Sections.map(section => {
        let comp;
        switch (section.SectionType) {
          case 'text':
            comp = <SectionRendererText section={section}/>;
            break;
          case 'title':
            comp = <SectionRendererTitle section={section}/>;
            break;
          case 'separator-x':
            comp = <hr/>;
            break;
          case 'hero':
            comp = <SectionRendererHero isTopHero={isTopHero} section={section}/>;
            break;
          case 'animal-list':
            comp = <SectionRendererAnimalList isTopHero={isTopHero} section={section}/>;
            break;
          default:
            comp = <div>Sektionstyp nicht unterst√ºtzt</div>;
            break;
          }
        return <div style={isTopHero ? 'margin-top: -' + topPadding + 'px' : ''} class={'section section-' + section.SectionType}>{comp}</div>;
        })
      return <div class={'row sui flex-x wrap' +  (isFullWidth ? ' full-width' : '')}>{sections}</div>
      }
    )
  }
</div>

<style is:global lang="scss">
  .article {
    gap: var(--section-gap-y);
    .row {
      gap: var(--section-gap-x);

      &:not(.full-width) {
        width: var(--wrapper-width);
        max-width: 100%;
        margin-left: auto;
        margin-right: auto;
      }
    }

    .section {
      flex-grow: 1;
    }

    .section-text {
      p {
        min-height: 1rem;
      }
    }

    .section-separator-x hr {
      border: none;
      background-color: #ddd;
      height: 1.5px;
      margin: 1.5rem 0;
    }

    .section-hero {
      width: 100dvw;
      left: 0;
    }
  }
</style>
