---
import { cms } from '@shared/cms/sheltify-access.ts';
import type { MenuEntry } from 'sheltify-lib/page-structure';
import { createPageStructure } from 'sheltify-lib/page-structure.ts';

const structure: Map<string, MenuEntry> =
  createPageStructure((await cms.getPages()).filter(page => page.PublishedAt?.Valid));

const entries = Array.from(structure.values());

const {entry} = Astro.props as { entry?: MenuEntry };
---
<div class="themable sitemap">
  {entry ? (
    <li>
      {entry.link ? (
        <a class="link" href={entry.link}>ğŸ— {entry.title}</a>
      ) : (
        <span>{entry.title}</span>
      )}

      {entry.children.length > 0 && (
        <ul>
          {entry.children.map((child) => (
            <Astro.self entry={child}/>
          ))}
        </ul>
      )}
    </li>
  ) : (
    <ul class="sitemap">
      {entries.map((entry) => (
        <Astro.self entry={entry}/>
      ))}
    </ul>
  )}
</div>

<style>
  li {
    list-style-type: none;
      line-height: 1.7rem;
  }
</style>
