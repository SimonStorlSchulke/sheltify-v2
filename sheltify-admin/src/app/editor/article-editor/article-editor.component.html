
<div class="sui flex-y grow-1 article-container card" [class.previewMode]="isPreviewMode()" [class.dragMode]="movedItem()">
<span class="sui flex-x jc-end grow-1 gap-2">
  @if (!saveArticle()) {
    <button data-testid="btn-save-article" class="grow-1 primary" (click)="save()">Speichern</button>
  }
  <button data-testid="btn-preview-article" (click)="isPreviewMode.set(!isPreviewMode())" [class]="isPreviewMode() ? 'primary' : 'secondary'">
    <ng-icon name="bootstrapEye"/>
  </button>
</span>

  <div (click)="addSectionAtNewRow(0)" (mouseup)="moveToNewRow(0)" data-testid="row-selector-0" class="move-to-row"></div>

  @if (article(); as article) {
    @for (row of article.Structure.Rows; track row) {
      @let iRow = $index;
      <div class="article-row sui flex-x jc-stretch" [class.previewMode]="isPreviewMode()">
        <div (mouseup)="moveToColumn(iRow,0)" (click)="addSectionAt(iRow, 0)" [attr.data-testid]="'column-selector-' + iRow + '-' + 0" class="move-to-column"></div>
        @for (section of row.Sections; track section) {
          @let iColumn = $index;
          @let numSections = row.Sections.length;
          @let gapsWidth = 34 * (numSections + 1);
          <div [style]="'width: calc(' + (100 / numSections) + '% - ' + gapsWidth + 'px)' " class="sui flex-y grow-1">

            <div #articleColumn class="article-column sui grow-1">
              <app-section-editor [section]="section"/>
            </div>

          </div>
          <div (mouseup)="moveToColumn(iRow, iColumn + 1)" (click)="addSectionAt(iRow, iColumn + 1)" [attr.data-testid]="'column-selector-' + iRow + '-' + (iColumn + 1)"
               class="move-to-column"></div>
        }
      </div>
      <div (click)="addSectionAtNewRow(iRow + 1)" (mouseup)="moveToNewRow(iRow + 1)" [attr.data-testid]="'row-selector-' + iRow + 1" class="move-to-row"></div>
    }
  }
  <span class="overscroll"></span>
</div>
